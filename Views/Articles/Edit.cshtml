@model SellMyStuff.Models.Article

@using (Html.BeginForm("Edit", "Articles", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h2>Update @Model.Name</h2>
        <hr />

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)

    <div class="col-md-6 ">

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">PRODUCT DETAILS</h3>
            </div>
        </div>

        <div class="form-group">
            @Html.Label("Category", htmlAttributes: new { @class = "control-label col-md-2" })

            <div class="col-md-10">
                @Html.DropDownList("ArticlesGroupId", null, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.ArticlesGroupId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextAreaFor(model => model.Description, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.StockQty, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.StockQty, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.StockQty, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Price, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Price, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Colour, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @*@Html.DropDownList("Colour", new MultiSelectList(Enum.GetValues(typeof(SellMyStuff.Enums.Colour))), Model.Colour, new { multiple = "multiple", @class = "form-control" })*@
                @Html.DropDownList("Colour", new SelectList(Enum.GetValues(typeof(SellMyStuff.Enums.Colour))), Model.Colour, new { @class = "form-control" })
            </div>
        </div>       
    </div>

    <div class="col-md-6 ">

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">PHOTOS</h3>
            </div>
        </div>

        <div class="form-group ">

            @foreach (var item in Model.Images)
             {
                <div class="col-md-4">
                
                    <img style="height: 100px; width: 100px; display: compact;" src="@Url.Content("~/Photos/" + item.FileName)" alt="Card image">
                    <br /><br />
                    <a href="javascript:void(0);" data-id="@item.Id" class="deleteItem btn btn-default"> Remove Photo</a>

                </div>

             }
        </div>
    </div>

    <div class="col-md-6 ">
        <hr />

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">ADD PHOTOS</h3>
            </div>
        </div>

        <div class="form-group">

            <div class="col-md-4 " id='filecontainer'>

                <input type='file' class="dimmy" id="image-input" name="files[]" multiple="multiple" />
            </div>
        </div>

        <div class="form-group">
                                
            <div class="preview-area col-md-12"></div>

        </div>
    </div>
        
    <hr />
    <div class="form-group ">
                
        <div class="col-md-10">
            <input type="submit" value="Update Product" class="btn btn-primary" />
        </div>
    </div>        
</div>
}

<div>

    @Html.ActionLink("Cancel", "Index", "Articles", null, new { @class = "btn btn-primary" })
</div>

@section scripts
{
    <script>    

        $('.deleteItem').click(function (e) {
            e.preventDefault();
            var $ctrl = $(this);

            if (confirm('Do you really want to delete this file?')) {
                $.ajax({
                    url: '@Url.Action("DeletePhoto")',
                    type: 'POST',
                    data: { id: $(this).data('id') }
                }).done(function (data) {
                    if (data.Result == "OK") {
                        $ctrl.closest('div').remove();
                    }
                    else if (data.Result.Message) {
                        alert(data.Result.Message);
                    }
                }).fail(function () {
                    alert("There is something wrong. Please try again.");
                })
            }
        });
    </script>
}
